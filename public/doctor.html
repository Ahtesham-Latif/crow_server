<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HealthCare - Doctors</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background:#f0f2f5; padding:20px; }
    .header { background:white; padding:20px; border-radius:15px; box-shadow:0 4px 20px rgba(0,0,0,0.1); margin-bottom:30px; display:flex; justify-content:space-between; align-items:center; }
    .logo { font-weight:bold; font-size:24px; }
    .container { max-width:1000px; margin:0 auto; }
    .doctors-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(400px,1fr)); gap:25px; }
    .doctor-card { background:white; padding:20px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.1); }
    .doctor-header { display:flex; gap:15px; align-items:center; margin-bottom:15px; }
    .doctor-avatar { width:60px; height:60px; border-radius:50%; background:#667eea; color:white; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:24px; }
    .doctor-name { font-size:20px; font-weight:700; }
    .doctor-stats { display:flex; gap:15px; font-size:14px; color:#555; }
    .btn-schedule { margin-top:15px; width:100%; padding:12px; background:#48bb78; color:white; border:none; border-radius:10px; cursor:pointer; font-weight:700; }
    .btn-schedule:hover { background:#38a169; }
</style>
</head>
<body>
<div class="header">
    <div class="logo">HealthCare</div>
    <div>Doctors in <span id="categoryName"></span></div>
</div>

<div class="container">
    <div id="doctorsContainer">Loading doctors...</div>
</div>

<script>
function getInitials(name){
    return name.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
}

// Get category_id from URL query
const urlParams = new URLSearchParams(window.location.search);
const categoryId = urlParams.get('category_id');
const categoryName = urlParams.get('category_name') || "Selected Category";

document.getElementById("categoryName").textContent = decodeURIComponent(categoryName);

async function fetchDoctors(){
    const container = document.getElementById("doctorsContainer");
    container.innerHTML = "Loading doctors...";
    try{
        const res = await fetch(`/get_doctors?category_id=${categoryId}`);
        if(!res.ok) throw new Error("Failed to fetch doctors");
        const doctors = await res.json();
        container.innerHTML = "";
        if(doctors.length === 0){
            container.innerHTML = "<div>No doctors found for this category.</div>";
            return;
        }
        const grid = document.createElement("div");
        grid.className = "doctors-grid";
        doctors.forEach(doc=>{
            const card = document.createElement("div");
            card.className = "doctor-card";
            card.innerHTML = `
                <div class="doctor-header">
                    <div class="doctor-avatar">${getInitials(doc.doctor_name)}</div>
                    <div>
                        <div class="doctor-name">${doc.doctor_name}</div>
                        <div class="doctor-stats">
                            <span>üéì ${doc.qualifications}</span>
                            <span>üíº ${doc.experience_years} yrs</span>
                            <span>‚≠ê ${doc.ratings}</span>
                        </div>
                    </div>
                </div>
                <button class="btn-schedule" onclick="goToSchedule(${doc.doctor_id}, '${encodeURIComponent(doc.doctor_name)}')">
                    üìÖ View Schedule & Book Appointment
                </button>
            `;
            grid.appendChild(card);
        });
        container.appendChild(grid);
    }catch(err){
        console.error(err);
        container.innerHTML = "<div style='color:red;'>Error loading doctors.</div>";
    }
}

// NEW: Route to schedule_page instead of appointment_page
function goToSchedule(doctorId, doctorName){
    window.location.href = `/schedule_page?doctor_id=${doctorId}&doctor=${doctorName}&category_name=${encodeURIComponent(categoryName)}`;
}

fetchDoctors();
</script>
</body>
</html>
